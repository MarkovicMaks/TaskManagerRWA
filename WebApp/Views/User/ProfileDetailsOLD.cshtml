@model WebApp.ViewModels.UserVM

@{
    ViewData["Title"] = "ProfileDetails";
}

<h1>ProfileDetails</h1>

<div>
    <h4>UserVm</h4>
    <hr />
    <dl class="row">
        <dt class = "col-sm-2">
            @Html.DisplayNameFor(model => model.Id)
        </dt>
        <dd class = "col-sm-10">
            @Html.DisplayFor(model => model.Id)
        </dd>
        <dt class = "col-sm-2">
            @Html.DisplayNameFor(model => model.Role)
        </dt>
        <dd class = "col-sm-10">
            @Html.DisplayFor(model => model.Role)
        </dd>
        <dt class = "col-sm-2">
            @Html.DisplayNameFor(model => model.Username)
        </dt>
        <dd class = "col-sm-10">
            @Html.DisplayFor(model => model.Username)
        </dd>
        <dt class = "col-sm-2">
            @Html.DisplayNameFor(model => model.Password)
        </dt>
        <dd class = "col-sm-10">
            @Html.DisplayFor(model => model.Password)
        </dd>
        <dt class = "col-sm-2">
            @Html.DisplayNameFor(model => model.FirstName)
        </dt>
        <dd class="col-sm-10" id="FirstName">
            @Html.DisplayFor(model => model.FirstName)
        </dd>
        <dt class = "col-sm-2">
            @Html.DisplayNameFor(model => model.LastName)
        </dt>
        <dd class = "col-sm-10">
            @Html.DisplayFor(model => model.LastName)
        </dd>
        <dt class = "col-sm-2">
            @Html.DisplayNameFor(model => model.Email)
        </dt>
        <dd class = "col-sm-10">
            @Html.DisplayFor(model => model.Email)
        </dd>
        <dt class = "col-sm-2">
            @Html.DisplayNameFor(model => model.Phone)
        </dt>
        <dd class = "col-sm-10">
            @Html.DisplayFor(model => model.Phone)
        </dd>
    </dl>
</div>
<div>
    @Html.ActionLink("Edit", "ProfileEdit", new { /* id = Model.PrimaryKey */ }) |
    <a asp-action="Index">Back to List</a>
</div>

@section Scripts {
    <script>
        const modelId = "@Model.Id";
        $("#ajaxUpdate").click(() => {
            $.ajax({
                url: `/User/GetProfileData/${modelId}`,
                method: "GET"
            })
                .done((data) => {
                    $("#FirstName").text(data.firstName);
                    $("#LastName").text(data.lastName);
                    $("#Email").text(data.email);
                    $("#Phone").text(data.phone);
                });
        })

        const ajaxEditModalEl = $("#AjaxEditModal")[0];
        const ajaxEditModal = new bootstrap.Modal(ajaxEditModalEl);

        $("#ajaxEdit").click((e) => {
            e.preventDefault();

            const firstName = $("#FirstName").text().trim();
            const lastName = $("#LastName").text().trim();
            const email = $("#Email").text().trim();
            const phone = $("#Phone").text().trim();

            $("#FirstNameInput").val(firstName);
            $("#LastNameInput").val(lastName);
            $("#EmailInput").val(email);
            $("#PhoneInput").val(phone);
            ajaxEditModal.show();
        });

        $("#SaveProfileButton").click(() => {
            const profile = {
                firstName: $("#FirstNameInput").val(),
                lastName: $("#LastNameInput").val(),
                email: $("#EmailInput").val(),
                phone: $("#PhoneInput").val(),
            };

            $.ajax({
                url: `/User/SetProfileData/${modelId}`,
                method: "PUT",
                contentType: "application/json",
                data: JSON.stringify(profile)
            })
                .done((data) => {
                    ajaxEditModal.hide();

                    $("#ajaxUpdate").trigger("click");
                })
                .fail(() => {
                    alert("ERROR: Could not update profile");
                })
        })
    </script>
}

